{% extends '::base.html.twig' %}

{% block body -%}
    <h1>Listado de Reservas</h1>

    <form id="formulariobase">

        <div class="input-daterange input-group" id="datepicker" class="datepicker">
            <label class="col-sm-1 col-lg-1 control-label" for="fechadesde">Desde</label>
            <div class="col-sm-2 col-lg-2">
                <input type="text" class="input-sm form-control" id="fechadesde" name="fechadesde" size="10" value="{{ "now"|date('Y-m-d')}}"/>
            </div>
            <label class="col-sm-1 col-lg-1 control-label" for="fechahasta">hasta</label>
            <div class="col-sm-2 col-lg-2">
                <input type="text" class="input-sm form-control" id="fechahasta" name="fechahasta" size="10" value="{{ "now"|date_modify('+7 days')|date('Y-m-d')}}"/>
            </div>
        </div>

        <select name="evento">
            <option value="0">TODOS LOS EVENTOS</option>
            {% for evento in eventos %}
                <option value="{{ evento.id }}">{{ evento.getNombre() }}</option>
            {% endfor %}
        </select>
        <select name="aula">
            <option value="0">TODAS LAS AULAS</option>
            {% for aula in aulas %}
                <option value="{{ aula.id }}">{{ aula.getNombre() }}</option>
            {% endfor %}
        </select>
        <select name="docente">
            <option value="0">TODOS LOS DOCENTES</option>
            {% for docente in docentes %}
                <option value="{{ docente.id }}">{{ docente.getNombre() }}</option>
            {% endfor %}
        </select>

        {# <p>Date: <input type="text" id="datepicker" size="30"></p> #}
        {#
        <div class="input-group date alone">
          <input type="text" class="form-control"><span class="input-group-addon"><i class="glyphicon glyphicon-th"></i></span>
        </div> 
        #}

    </form>

    <button id="btnFiltro">Aplicar Filtro</button>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Id</th>
                <th>Fecha</th>
                <th>Desde</th>
                <th>Hasta</th>
                <th>Evento</th>
                <th>Aula</th>
                <th>Estado</th>
                <th>Observacion</th>
                <th>Recursos</th>
                <th>Reservado</th>
                <th>Docente</th>
            </tr>
        </thead>
        <tbody class="listado_tabla">
        </tbody>
    </table>

{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" tyep="text/html" href="{{ asset('bundles/untdfreservasaulas/vendor/bootstrap-datepicker/css/bootstrap-datepicker3.standalone.min.css')}}" />
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('bundles/untdfreservasaulas/vendor/bootstrap-datepicker/js/bootstrap-datepicker.min.js')}}"></script>
    <script src="{{ asset('bundles/untdfreservasaulas/vendor/bootstrap-datepicker/locales/bootstrap-datepicker.es.min.js')}}"></script>
    <script>
        $(document).ready(function () {
            $('.input-daterange.input-group').datepicker({
                format: "yyyy-mm-dd",
                startDate: "2014/01/01",
                endDate: "2016/12/31",
                todayBtn: "linked",
                clearBtn: true,
                language: "es",
                autoclose: true,
                orientation: "top auto",
                todayHighlight: true
            });
                
            $("#btnFiltro").click(function () {
                $(".listado_tabla_item").remove();
                //$.getJSON("https://127.0.0.1/reservas/web/app_dev.php/listadoReservas", 
                var pFechadesde = $("#formulariobase :input[name='fechadesde']").val(); 
                var pFechahasta = $("#formulariobase :input[name='fechahasta']").val();
                var pEvento = $("#formulariobase :input[name='evento']").val();
                var pAula = $("#formulariobase :input[name='aula']").val();
                var pDocente = $("#formulariobase :input[name='docente']").val();
                $.getJSON("listadoReservas",
                    { fechadesde: pFechadesde, 
                        fechahasta: pFechahasta,
                        evento: pEvento,
                        aula: pAula,
                        docente: pDocente  
                    },
                    function(result){
                        $.each(result, function(i, field){                            
                            var tabla_item = "";
                            tabla_item = "<tr class='listado_tabla_item'>";
                            tabla_item = tabla_item + "<td>" + field.id + "</td>";
                            tabla_item = tabla_item + "<td>" + field.fecha + "</td>";
                            tabla_item = tabla_item + "<td>" + field.horadesde + "</th>";
                            tabla_item = tabla_item + "<td>" + field.horahasta + "</th>";
                            tabla_item = tabla_item + "<td>" + field.evento + "</th>";
                            tabla_item = tabla_item + "<td>" + field.aula + "</th>";
                            tabla_item = tabla_item + "<td>" + field.estado + "</th>";
                            tabla_item = tabla_item + "<td>" + field.observacion + "</th>";
                            tabla_item = tabla_item + "<td>" + field.recursos + "</th>";
                            tabla_item = tabla_item + "<td>" + field.reservado + "</th>";
                            tabla_item = tabla_item + "<td>" + field.docente + "</th>";
                            tabla_item = tabla_item + "</tr>";
                            $(".listado_tabla").append(tabla_item);
                        });
                    });
                });
            });
    </script>

{% endblock %}

